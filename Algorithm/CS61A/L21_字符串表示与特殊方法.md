# ğŸ“˜ Lecture 21ï¼šå­—ç¬¦ä¸²è¡¨ç¤ºä¸ç‰¹æ®Šæ–¹æ³•
> åœ¨é¢å‘å¯¹è±¡ç¼–ç¨‹ä¸­ï¼Œå¯¹è±¡ä¸ä»…è¦å­˜å‚¨æ•°æ®ï¼Œè¿˜è¦èƒ½å¤Ÿä»¥é€‚å½“çš„å½¢å¼â€œæè¿°â€è‡ªå·±ã€‚Python é€šè¿‡Â `__repr__`Â å’ŒÂ `__str__`Â ä¸¤ä¸ªç‰¹æ®Šæ–¹æ³•ä¸ºæ‰€æœ‰å¯¹è±¡æä¾›äº†ä¸¤ç§å­—ç¬¦ä¸²è¡¨ç¤ºã€‚æ­¤å¤–ï¼Œç‰¹æ®Šæ–¹æ³•è¿˜å…è®¸æˆ‘ä»¬é‡è½½è¿ç®—ç¬¦ã€å®šä¹‰ç±»å‹è½¬æ¢ç­‰ï¼Œä½¿è‡ªå®šä¹‰ç±»èƒ½å¤Ÿåƒå†…ç½®ç±»å‹ä¸€æ ·è‡ªç„¶ã€‚æœ¬èŠ‚è¯¾å°†å¸¦ä½ æ·±å…¥ç†è§£è¿™äº›æœºåˆ¶ï¼Œå¹¶å­¦ä¼šå¦‚ä½•ä¸ºè‡ªå·±çš„ç±»èµ‹äºˆä¸°å¯Œçš„â€œè¡Œä¸ºâ€ã€‚

---

## ä¸€ã€å­—ç¬¦ä¸²è¡¨ç¤º

### 1.1 ä¸ºä»€ä¹ˆéœ€è¦å­—ç¬¦ä¸²è¡¨ç¤ºï¼Ÿ

åœ¨ç¼–ç¨‹ä¸­ï¼Œå¯¹è±¡åº”è¯¥èƒ½å¤Ÿç”Ÿæˆè‡ªèº«çš„å­—ç¬¦ä¸²æè¿°ï¼Œè¿™æ—¢æ˜¯ä¸äººäº¤äº’çš„éœ€è¦ï¼ˆå¦‚æ‰“å°è¾“å‡ºï¼‰ï¼Œä¹Ÿæ˜¯ä¸ Python è§£é‡Šå™¨äº¤äº’çš„éœ€è¦ï¼ˆå¦‚äº¤äº’å¼ç¯å¢ƒæ˜¾ç¤ºï¼‰ã€‚å­—ç¬¦ä¸²åœ¨ç¼–ç¨‹è¯­è¨€ä¸­æ‰®æ¼”ç€é‡è¦è§’è‰²ï¼Œå®ƒä»¬ä¸ä»…ç”¨äºè‡ªç„¶è¯­è¨€äº¤æµï¼Œä¹Ÿç”¨äºè¡¨ç¤ºç¨‹åºå’Œæ•°æ®ç»“æ„ã€‚

### 1.2 Python çš„åŒè¡¨ç¤ºç³»ç»Ÿ

Python ä¸ºæ¯ä¸ªå¯¹è±¡æä¾›**ä¸¤ç§**å­—ç¬¦ä¸²è¡¨ç¤ºï¼š

- **`repr`**ï¼ˆrepresentationï¼‰ï¼šé¢å‘ Python è§£é‡Šå™¨çš„è¡¨ç¤ºï¼Œå…¶ç›®æ ‡è¾“å‡ºæ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œå¦‚æœå¯èƒ½ï¼Œè¿™ä¸ªå­—ç¬¦ä¸²åº”è¯¥æ˜¯æœ‰æ•ˆçš„ Python è¡¨è¾¾å¼ï¼Œèƒ½å¤Ÿé€šè¿‡Â `eval()`Â æ±‚å€¼å¾—åˆ°ä¸åŸå¯¹è±¡ç›¸ç­‰çš„å¯¹è±¡ã€‚
    
- **`str`**ï¼ˆstringï¼‰ï¼šé¢å‘äººç±»çš„å¯è¯»è¡¨ç¤ºï¼Œå…¶ç›®æ ‡æ˜¯æ¸…æ™°æ˜“æ‡‚ï¼Œä¸ä¸€å®šæ˜¯åˆæ³•çš„ Python è¡¨è¾¾å¼ã€‚
    

å†…ç½®å‡½æ•°Â `repr(obj)`Â å’ŒÂ `str(obj)`Â åˆ†åˆ«ç”¨äºè·å–è¿™ä¸¤ç§è¡¨ç¤ºã€‚åœ¨äº¤äº’å¼ç¯å¢ƒä¸­ï¼Œç›´æ¥è¾“å…¥å¯¹è±¡åæˆ–è¡¨è¾¾å¼ï¼Œä¼šæ˜¾ç¤ºå…¶Â `repr`Â è¡¨ç¤ºï¼›è€ŒÂ `print(obj)`Â åˆ™ä¼šæ˜¾ç¤ºå…¶Â `str`Â è¡¨ç¤ºã€‚

> ğŸ’¡Â **ä¸¤è€…ç»å¸¸ç›¸åŒï¼Œä½†å¹¶éå¿…é¡»**ã€‚ä¾‹å¦‚ï¼Œåˆ†æ•°å¯¹è±¡Â `Fraction(1,2)`Â çš„Â `repr`Â æ˜¯Â `'Fraction(1,2)'`ï¼ˆå¯æ±‚å€¼ï¼‰ï¼Œè€ŒÂ `str`Â æ˜¯Â `'1/2'`ï¼ˆäººç±»å‹å¥½ï¼‰ã€‚

### 1.3Â `repr`Â å‡½æ•°ï¼šå¯è§£é‡Šçš„è¡¨è¾¾å¼

`repr(obj)`Â è¿”å›ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œç†æƒ³æƒ…å†µä¸‹æ»¡è¶³Â `eval(repr(obj)) == obj`ã€‚å¯¹äºå¤§å¤šæ•°å†…ç½®ç±»å‹ï¼Œè¿™ä¸€æ€§è´¨æˆç«‹ã€‚


```python

>>> repr(12e12)
'1200000000000.0'
>>> eval(repr(12e12))
1200000000000.0
```
å¯¹äºæ— æ³•ç”¨ç®€å•è¡¨è¾¾å¼è¡¨ç¤ºçš„å¯¹è±¡ï¼ˆå¦‚å‡½æ•°ã€ç±»ã€æ¨¡å—ï¼‰ï¼Œ`repr`Â ä¼šè¿”å›ä¸€ä¸ªå¸¦å°–æ‹¬å·çš„æè¿°ï¼š

```python

>>> repr(print)
'<built-in function print>'
>>> repr(int)
"<class 'int'>"
```
### 1.4Â `str`Â å‡½æ•°ï¼šäººç±»å¯è¯»çš„è¡¨ç¤º

`str(obj)`Â è¿”å›ä¸€ä¸ªé€‚åˆäººç±»é˜…è¯»çš„å­—ç¬¦ä¸²ã€‚å®ƒé€šå¸¸æ¯”Â `repr`Â æ›´ç®€æ´ã€æ›´å‹å¥½ã€‚

```python

>>> from fractions import Fraction
>>> half = Fraction(1, 2)
>>> repr(half)
'Fraction(1, 2)'
>>> str(half)
'1/2'
```
æ³¨æ„ï¼Œ`eval(str(half))`Â ä¸ä¼šå¾—åˆ°åˆ†æ•°ï¼Œå› ä¸ºÂ `'1/2'`Â åœ¨ Python ä¸­ä¼šè¢«è§£é‡Šä¸ºæµ®ç‚¹æ•°é™¤æ³•ï¼Œç»“æœä¸ºÂ `0.5`ã€‚è¿™æ°å¥½å·§åˆåœ°ç­‰äºÂ `Fraction(1,2)`Â çš„æ•°å€¼ï¼Œä½†æ¦‚å¿µä¸Šä¸åŒã€‚

### 1.5 å­—ç¬¦ä¸²è‡ªèº«çš„è¡¨ç¤º

å¯¹äºå­—ç¬¦ä¸²æœ¬èº«ï¼Œ`str(s)`Â è¿”å›Â `s`Â è‡ªèº«ï¼Œè€ŒÂ `repr(s)`Â è¿”å›å¸¦å¼•å·çš„å­—ç¬¦ä¸²ï¼Œä¸”å†…éƒ¨å¼•å·ä¼šè¢«è½¬ä¹‰ã€‚

```python

>>> s = 'hello\nworld'
>>> str(s)
'hello\nworld'
>>> repr(s)
"'hello\\nworld'"
```
å¤šæ¬¡åº”ç”¨Â `repr`Â ä¼šäº§ç”ŸåµŒå¥—å¼•å·ï¼Œä½†Â `eval`Â å¯ä»¥é€å±‚è¿˜åŸï¼š

```python

>>> repr(repr(s))
"'\\'hello\\\\nworld\\''"
>>> eval(eval(repr(repr(s)))) == s
True
```
---

## äºŒã€å­—ç¬¦ä¸²æ’å€¼

### 2.1 å­—ç¬¦ä¸²è¿æ¥æ–¹å¼

ä¼ ç»Ÿæ–¹å¼æ„å»ºåŒ…å«å˜é‡å€¼çš„å­—ç¬¦ä¸²éœ€è¦ä½¿ç”¨Â `+`Â è¿æ¥ï¼Œå¹¶æ‰‹åŠ¨è½¬æ¢ç±»å‹ï¼š

```python

>>> from math import pi
>>> 'pi starts with ' + str(pi) + '...'
'pi starts with 3.141592653589793...'
```
è¿™ç§æ–¹æ³•ä»£ç å†—é•¿ï¼Œå®¹æ˜“å‡ºé”™ï¼Œä¸”æ•ˆç‡è¾ƒä½ã€‚

### 2.2 f-string è¯­æ³•ä¸ä¼˜åŠ¿

Python 3.6 å¼•å…¥äº†**æ ¼å¼åŒ–å­—ç¬¦ä¸²å­—é¢é‡**ï¼ˆf-stringï¼‰ï¼Œåœ¨å­—ç¬¦ä¸²å‰åŠ Â `f`Â æˆ–Â `F`ï¼Œå¹¶ç”¨å¤§æ‹¬å·Â `{}`Â åŒ…è£¹è¡¨è¾¾å¼ï¼Œè¡¨è¾¾å¼ä¼šåœ¨è¿è¡Œæ—¶æ±‚å€¼å¹¶è‡ªåŠ¨è½¬æ¢ä¸ºå­—ç¬¦ä¸²ã€‚

```python

>>> f'pi starts with {pi}...'
'pi starts with 3.141592653589793...'
```
**ä¼˜ç‚¹**ï¼š

- ç®€æ´ç›´è§‚ã€‚
    
- æ”¯æŒä»»æ„åˆæ³• Python è¡¨è¾¾å¼ã€‚
    
- è¡¨è¾¾å¼å¯ä»¥ä½¿ç”¨å½“å‰ç¯å¢ƒä¸­çš„å˜é‡ã€‚
    
- è‡ªåŠ¨è°ƒç”¨Â `__str__`Â è½¬æ¢ï¼ˆé™¤éä½¿ç”¨è½¬æ¢æ ‡å¿—ï¼‰ã€‚
    

### 2.3 è¡¨è¾¾å¼æ±‚å€¼ä¸å‰¯ä½œç”¨

f-string ä¸­çš„è¡¨è¾¾å¼æŒ‰ä»å·¦åˆ°å³çš„é¡ºåºæ±‚å€¼ï¼Œè¿™æ„å‘³ç€å¦‚æœè¡¨è¾¾å¼æœ‰å‰¯ä½œç”¨ï¼ˆå¦‚ä¿®æ”¹åˆ—è¡¨ï¼‰ï¼Œä¼šå½±å“åç»­è¡¨è¾¾å¼çš„ç»“æœã€‚

```python

>>> lst = [7, 8, 9]
>>> f'because {lst.pop()}, {lst.pop()}, {lst.pop()}'
'because 9, 8, 7'
>>> lst
[]
```
**æ³¨æ„**ï¼šå‰¯ä½œç”¨å¯èƒ½å¯¼è‡´éš¾ä»¥è°ƒè¯•çš„é—®é¢˜ï¼Œåº”é¿å…åœ¨ f-string ä¸­ä½¿ç”¨å¸¦å‰¯ä½œç”¨çš„è¡¨è¾¾å¼ã€‚

### 2.4 å¼ºåˆ¶ä½¿ç”¨Â `repr`

é»˜è®¤æƒ…å†µä¸‹ï¼Œf-string ä½¿ç”¨Â `__str__`Â è½¬æ¢å¯¹è±¡ã€‚å¦‚æœéœ€è¦Â `repr`Â è¡¨ç¤ºï¼Œå¯ä»¥ä½¿ç”¨Â `!r`Â è½¬æ¢æ ‡å¿—ï¼š

```python

>>> from fractions import Fraction
>>> half = Fraction(1, 2)
>>> f'{half} = {half!r}'
'1/2 = Fraction(1, 2)'
```
---

## ä¸‰ã€å¤šæ€å‡½æ•°

### 3.1 å¤šæ€çš„æ¦‚å¿µ

**å¤šæ€**ï¼ˆpolymorphismï¼‰æŒ‡ä¸€ä¸ªå‡½æ•°èƒ½å¤Ÿåº”ç”¨äºå¤šç§ä¸åŒç±»å‹çš„æ•°æ®ã€‚â€œpolyâ€æ„ä¸ºâ€œå¤šâ€ï¼Œâ€œmorphâ€æ„ä¸ºâ€œå½¢æ€â€ã€‚

### 3.2Â `str`Â å’ŒÂ `repr`Â ä½œä¸ºå¤šæ€å‡½æ•°

`str()`Â å’ŒÂ `repr()`Â æ˜¯å…¸å‹çš„å¤šæ€å‡½æ•°â€”â€”å®ƒä»¬å¯ä»¥æ¥å—**ä»»ä½•**å¯¹è±¡ä½œä¸ºå‚æ•°ï¼Œå¹¶è¿”å›åˆé€‚çš„å­—ç¬¦ä¸²ã€‚æ— è®ºä¼ å…¥çš„æ˜¯æ•´æ•°ã€åˆ—è¡¨ã€å‡½æ•°è¿˜æ˜¯è‡ªå®šä¹‰ç±»çš„å®ä¾‹ï¼Œè¿™ä¸¤ä¸ªå‡½æ•°éƒ½èƒ½å·¥ä½œã€‚

### 3.3 å®ç°åŸç†ï¼šç‰¹æ®Šæ–¹æ³•

å¤šæ€çš„å®ç°ä¾èµ–äºå¯¹è±¡æä¾›çš„ç»Ÿä¸€æ¥å£ã€‚`str(obj)`Â å®é™…ä¸Šè°ƒç”¨çš„æ˜¯Â `obj.__str__()`ï¼Œè€ŒÂ `repr(obj)`Â è°ƒç”¨çš„æ˜¯Â `obj.__repr__()`ã€‚æ¯ä¸ªç±»éƒ½å¯ä»¥è‡ªå®šä¹‰è¿™äº›æ–¹æ³•ï¼Œä»è€Œæ§åˆ¶å¯¹è±¡å¦‚ä½•è¢«è½¬æ¢ä¸ºå­—ç¬¦ä¸²ã€‚

```python

>>> half.__repr__()
'Fraction(1, 2)'
>>> half.__str__()
'1/2'
```
### 3.4 è®¾è®¡ä¼˜åŠ¿

- **ç®€æ´æ€§**ï¼šå¤šæ€å‡½æ•°æœ¬èº«å‡ ä¹ä¸åŒ…å«é€»è¾‘ï¼Œåªæ˜¯å°†å·¥ä½œå§”æ‰˜ç»™å‚æ•°å¯¹è±¡ã€‚
    
- **çµæ´»æ€§**ï¼šæ–°ç±»å‹åªéœ€å®ç°ç›¸åº”çš„ç‰¹æ®Šæ–¹æ³•ï¼Œå°±èƒ½æ— ç¼èå…¥ç°æœ‰ç³»ç»Ÿã€‚
    
- **å¯æ‰©å±•æ€§**ï¼šæ— éœ€ä¿®æ”¹å·²æœ‰å‡½æ•°ï¼Œå³å¯æ”¯æŒæ–°çš„æ•°æ®ç±»å‹ã€‚
    

---

## å››ã€`__repr__`Â å’ŒÂ `__str__`Â çš„å®ç°ç»†èŠ‚

### 4.1Â `repr`Â çš„åº•å±‚å®ç°ï¼šå¿½ç•¥å®ä¾‹å±æ€§

`repr(x)`Â çš„å®ç°æ¯”ç®€å•è°ƒç”¨Â `x.__repr__()`Â ç•¥å¤æ‚ã€‚å®ƒ**å¿½ç•¥**å®ä¾‹ä¸Šåä¸ºÂ `__repr__`Â çš„å±æ€§ï¼ŒåªæŸ¥æ‰¾ç±»å±æ€§ï¼ˆå³æ–¹æ³•ï¼‰ã€‚è¿™æ˜¯ä¸ºäº†é˜²æ­¢å®ä¾‹æ„å¤–åœ°å°†Â `__repr__`Â è®¾ç½®ä¸ºéå‡½æ•°å¯¹è±¡ï¼Œå¯¼è‡´Â `repr`Â å¤±æ•ˆã€‚

æ­£ç¡®çš„å†…éƒ¨å®ç°ç±»ä¼¼äºï¼š

```python

def repr(x):
    return type(x).__repr__(x)   # é€šè¿‡ç±»æŸ¥æ‰¾æ–¹æ³•ï¼Œå¹¶æ˜¾å¼ä¼ é€’å®ä¾‹
```
è¿™æ ·ç¡®ä¿äº†è°ƒç”¨çš„æ˜¯ç±»ä¸­å®šä¹‰çš„æ–¹æ³•ï¼Œè€Œä¸æ˜¯å®ä¾‹å±æ€§ã€‚

### 4.2Â `str`Â çš„å®ç°æœºåˆ¶

ç±»ä¼¼åœ°ï¼Œ`str(x)`Â ä¼˜å…ˆè°ƒç”¨Â `x.__str__()`ï¼Œä½†å¦‚æœæœªå®šä¹‰ï¼Œåˆ™å›é€€åˆ°Â `__repr__`ã€‚å…¶å†…éƒ¨å®ç°ä¹Ÿéµå¾ªç±»å±æ€§ä¼˜å…ˆçš„åŸåˆ™ã€‚

### 4.3 æ¶ˆæ¯ä¼ é€’ä¸å±æ€§æŸ¥æ‰¾

é¢å‘å¯¹è±¡ç¼–ç¨‹çš„æ ¸å¿ƒéšå–»æ˜¯**å¯¹è±¡ä¹‹é—´é€šè¿‡ä¼ é€’æ¶ˆæ¯è¿›è¡Œäº¤äº’**ã€‚åœ¨ Python ä¸­ï¼Œâ€œæ¶ˆæ¯â€å°±æ˜¯å±æ€§åï¼ˆé€šå¸¸æ˜¯æ–¹æ³•åï¼‰ï¼Œå¯¹è±¡é€šè¿‡æŸ¥æ‰¾å±æ€§æ¥å“åº”æ¶ˆæ¯ã€‚å¤šæ€æ­£æ˜¯é€šè¿‡è¿™ä¸€æœºåˆ¶å®ç°çš„ï¼šä¸åŒç±»çš„å¯¹è±¡å“åº”ç›¸åŒçš„æ¶ˆæ¯ï¼ˆå¦‚Â `__repr__`ï¼‰æ—¶ï¼Œæ‰§è¡Œå„è‡ªçš„è¡Œä¸ºã€‚

è¿™ç§è®¾è®¡ä½¿å¾—æˆ‘ä»¬å¯ä»¥å®šä¹‰**æ¥å£**ï¼ˆä¸€ç»„å…±äº«çš„æ¶ˆæ¯åŠå…¶è§„èŒƒï¼‰ï¼Œä»è€Œç¼–å†™ä¸å…·ä½“ç±»å‹æ— å…³çš„é€šç”¨ä»£ç ã€‚

---

## äº”ã€æ¥å£

### 5.1 æ¥å£å®šä¹‰

**æ¥å£**æ˜¯ä¸€ç»„å…±äº«çš„æ¶ˆæ¯ï¼ˆå³å±æ€§åï¼‰ä»¥åŠå…³äºè¿™äº›æ¶ˆæ¯è¡Œä¸ºçš„è§„èŒƒã€‚æ¥å£ä¸å¿…æ˜¯è¯­è¨€å†…ç½®çš„ï¼Œå½“å¤šä¸ªç±»æä¾›ç›¸åŒçš„æ–¹æ³•åä¸”è¿™äº›æ–¹æ³•æ‰§è¡Œç›¸ä¼¼çš„æ“ä½œæ—¶ï¼Œå°±éšå¼åœ°åˆ›å»ºäº†ä¸€ä¸ªæ¥å£ã€‚

ä¾‹å¦‚ï¼ŒPython ä¸­çš„Â `__repr__`Â å’ŒÂ `__str__`Â æ„æˆäº†**å­—ç¬¦ä¸²è¡¨ç¤ºæ¥å£**ï¼šä»»ä½•ç±»åªè¦å®šä¹‰äº†è¿™ä¸¤ä¸ªæ–¹æ³•ï¼Œå°±èƒ½ä¸Â `repr()`ã€`str()`ã€`print()`Â ç­‰å‡½æ•°ååŒå·¥ä½œã€‚

### 5.2 è‡ªå®šä¹‰æ¥å£ç¤ºä¾‹ï¼š`Ratio`Â ç±»

è®©æˆ‘ä»¬é€šè¿‡ä¸€ä¸ªè‡ªå®šä¹‰çš„Â `Ratio`Â ç±»ï¼ˆæ¯”ä¾‹ç±»ï¼‰æ¥å®è·µæ¥å£çš„å®ç°ã€‚

```python

class Ratio:
    def __init__(self, n, d):
        self.numer = n
        self.denom = d
    def __repr__(self):
        return f'Ratio({self.numer}, {self.denom})'
    def __str__(self):
        return f'{self.numer}/{self.denom}'
```
ä½¿ç”¨ï¼š

```python

>>> half = Ratio(1, 2)
>>> half           # è°ƒç”¨ __repr__
Ratio(1, 2)
>>> print(half)    # è°ƒç”¨ __str__
1/2
```
è¿™æ ·ï¼Œ`Ratio`Â ç±»å°±æˆåŠŸåŠ å…¥äº†å­—ç¬¦ä¸²è¡¨ç¤ºæ¥å£ã€‚

---

## å…­ã€ç‰¹æ®Šæ–¹æ³•å

### 6.1 ç‰¹æ®Šæ–¹æ³•æ¦‚è¿°

Python ä¸­æœ‰ä¸€ç±»ä»¥åŒä¸‹åˆ’çº¿å¼€å¤´å’Œç»“å°¾çš„æ–¹æ³•åï¼Œç§°ä¸º**ç‰¹æ®Šæ–¹æ³•**ï¼ˆspecial methodsï¼‰æˆ–**é­”æœ¯æ–¹æ³•**ï¼ˆmagic methodsï¼‰ã€‚å®ƒä»¬ä¸å†…ç½®å‡½æ•°æˆ–è¿ç®—ç¬¦ç›¸å¯¹åº”ï¼Œå½“è¿›è¡Œç‰¹å®šæ“ä½œæ—¶ï¼ŒPython ä¼šè‡ªåŠ¨è°ƒç”¨è¿™äº›æ–¹æ³•ã€‚

å¸¸è§ç‰¹æ®Šæ–¹æ³•ï¼š

- `__init__`ï¼šå¯¹è±¡åˆå§‹åŒ–ã€‚
    
- `__repr__`ï¼š`repr()`Â è°ƒç”¨ã€‚
    
- `__str__`ï¼š`str()`Â è°ƒç”¨ã€‚
    
- `__add__`ï¼š`+`Â è¿ç®—ç¬¦ã€‚
    
- `__radd__`ï¼šå³ä¾§åŠ æ³•ï¼ˆå½“å·¦æ“ä½œæ•°ä¸æ”¯æŒåŠ æ³•æ—¶è°ƒç”¨ï¼‰ã€‚
    
- `__bool__`ï¼š`bool()`Â è°ƒç”¨ï¼Œç”¨äºçœŸå€¼æµ‹è¯•ã€‚
    
- `__float__`ï¼š`float()`Â è°ƒç”¨ã€‚
    

### 6.2Â `__init__`

`__init__`Â åœ¨å¯¹è±¡åˆ›å»ºåè‡ªåŠ¨è°ƒç”¨ï¼Œç”¨äºåˆå§‹åŒ–å®ä¾‹å±æ€§ã€‚

```python

def __init__(self, n, d):
    self.numer = n
    self.denom = d
```
### 6.3Â `__repr__`

`__repr__`Â åº”è¿”å›ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œé€šå¸¸æ˜¯å¯¹è±¡çš„â€œå®˜æ–¹â€è¡¨ç¤ºï¼Œæœ€å¥½èƒ½é€šè¿‡Â `eval`Â é‡å»ºå¯¹è±¡ã€‚

### 6.4Â `__add__`Â ä¸Â `__radd__`ï¼ˆè¿ç®—ç¬¦é‡è½½ï¼‰

é€šè¿‡å®šä¹‰Â `__add__`ï¼Œå¯ä»¥ä½¿è‡ªå®šä¹‰ç±»æ”¯æŒÂ `+`Â è¿ç®—ç¬¦ã€‚

```python

def __add__(self, other):
    if isinstance(other, Ratio):
        n = self.numer * other.denom + self.denom * other.numer
        d = self.denom * other.denom
        return Ratio(n, d)
    elif isinstance(other, int):
        n = self.numer + self.denom * other
        return Ratio(n, self.denom)
    else:
        return NotImplemented
```
`__radd__`Â ç”¨äºå¤„ç†å³æ“ä½œæ•°çš„æƒ…å†µï¼šå½“å·¦æ“ä½œæ•°ä¸æ”¯æŒä¸å³æ“ä½œæ•°çš„åŠ æ³•æ—¶ï¼ŒPython ä¼šå°è¯•è°ƒç”¨å³æ“ä½œæ•°çš„Â `__radd__`Â æ–¹æ³•ã€‚

```python

def __radd__(self, other):
    return self.__add__(other)   # åŠ æ³•é€šå¸¸å¯äº¤æ¢ï¼Œç›´æ¥å¤ç”¨ __add__
```
è¿™æ ·ï¼Œ`1 + Ratio(1,3)`Â å°±èƒ½æ­£ç¡®å·¥ä½œã€‚

### 6.5Â `__bool__`ã€`__float__`Â ç­‰

- `__bool__`ï¼šå®šä¹‰å¯¹è±¡åœ¨å¸ƒå°”ä¸Šä¸‹æ–‡ä¸­çš„çœŸå€¼ï¼Œå¦‚Â `if obj:`ã€‚
    
- `__float__`ï¼šå®šä¹‰Â `float(obj)`Â çš„è¡Œä¸ºã€‚
    

```python

def __bool__(self):
    return self.numer != 0
def __float__(self):
    return self.numer / self.denom
```
---

## ä¸ƒã€æ¯”ä¾‹ç±»ï¼ˆ`Ratio`ï¼‰çš„å®Œæ•´å®ç°

æˆ‘ä»¬å°†é€æ­¥æ„å»ºä¸€ä¸ªåŠŸèƒ½å®Œå¤‡çš„Â `Ratio`Â ç±»ï¼Œå±•ç¤ºä¸Šè¿°æ‰€æœ‰æ¦‚å¿µã€‚

### 7.1 åŸºç¡€ç»“æ„

```python

from math import gcd
class Ratio:
    def __init__(self, n, d):
        """åˆå§‹åŒ–å¹¶è‡ªåŠ¨çº¦åˆ†åˆ°æœ€ç®€å½¢å¼"""
        g = gcd(n, d)
        self.numer = n // g
        self.denom = d // g
    def __repr__(self):
        return f'Ratio({self.numer}, {self.denom})'
    def __str__(self):
        return f'{self.numer}/{self.denom}'
```
### 7.2 åŠ æ³•å®ç°ä¸çº¦åˆ†

```python

def __add__(self, other):
    if isinstance(other, Ratio):
        n = self.numer * other.denom + self.denom * other.numer
        d = self.denom * other.denom
        return Ratio(n, d)
    elif isinstance(other, int):
        # å°†æ•´æ•°è§†ä¸ºåˆ†æ¯ä¸º1çš„æ¯”ä¾‹
        return Ratio(self.numer + self.denom * other, self.denom)
    else:
        return NotImplemented
```
### 7.3 ç±»å‹æ£€æŸ¥ä¸æ··åˆè¿ç®—

ä¸ºäº†æ”¯æŒä¸æµ®ç‚¹æ•°ç­‰ç±»å‹çš„è¿ç®—ï¼Œå¯ä»¥æ‰©å±•Â `__add__`Â çš„ç±»å‹åˆ†æ”¯ï¼Œæˆ–å®ç°ç±»å‹è½¬æ¢ã€‚

### 7.4 å³ä¾§åŠ æ³•Â `__radd__`

```python

def __radd__(self, other):
    # å¤„ç† other æ˜¯æ•´æ•°çš„æƒ…å†µ
    if isinstance(other, int):
        return self.__add__(other)
    return NotImplemented
```
### 7.5 æµ®ç‚¹æ•°å¤„ç†ä¸ç±»å‹è½¬æ¢

```python

def __float__(self):
    return self.numer / self.denom
def __add__(self, other):
    if isinstance(other, Ratio):
        # ...
    elif isinstance(other, int):
        # ...
    elif isinstance(other, float):
        return float(self) + other   # å°† self è½¬ä¸ºæµ®ç‚¹æ•°å†è¿ç®—
    else:
        return NotImplemented
```
### 7.6 å®Œæ•´ç¤ºä¾‹

```python

>>> r1 = Ratio(1, 3)
>>> r2 = Ratio(1, 6)
>>> r1 + r2
Ratio(1, 2)
>>> r1 + 1
Ratio(4, 3)
>>> 1 + r1
Ratio(4, 3)
>>> r1 + 0.5
0.8333333333333333
>>> float(r1)
0.3333333333333333
```
---

## å…«ã€çŸ¥è¯†ç‚¹æ€»ç»“è¡¨

|çŸ¥è¯†ç‚¹|æ ¸å¿ƒå†…å®¹|è€ƒè¯•é‡ç‚¹ / æ˜“æ··æ·†ç‚¹|éš¾åº¦|
|---|---|---|---|
|**`repr`Â vsÂ `str`**|`repr`Â é¢å‘è§£é‡Šå™¨ï¼ˆå¯æ±‚å€¼ï¼‰ï¼Œ`str`Â é¢å‘äººç±»|`eval(repr(obj)) == obj`Â é€šå¸¸æˆç«‹ï¼›`str`Â å›é€€åˆ°Â `repr`|â­â­|
|**f-string æ’å€¼**|`f"{expr}"`Â è‡ªåŠ¨æ±‚å€¼å¹¶è½¬æ¢ï¼Œ`!r`Â å¼ºåˆ¶ä½¿ç”¨Â `repr`|è¡¨è¾¾å¼é¡ºåºæ±‚å€¼ï¼Œé¿å…å‰¯ä½œç”¨|â­â­|
|**å¤šæ€å‡½æ•°**|åŒä¸€å‡½æ•°å¯ä½œç”¨äºå¤šç§ç±»å‹ï¼Œå¦‚Â `str`ã€`repr`|é€šè¿‡ç‰¹æ®Šæ–¹æ³•å®ç°|â­â­|
|**ç‰¹æ®Šæ–¹æ³•**|`__init__`,Â `__repr__`,Â `__str__`,Â `__add__`,Â `__radd__`,Â `__bool__`,Â `__float__`|åç§°å›ºå®šï¼Œä¸å†…ç½®å‡½æ•°/è¿ç®—ç¬¦ç»‘å®š|â­â­â­|
|**æ¥å£**|ä¸€ç»„å…±äº«çš„æ¶ˆæ¯åŠè§„èŒƒï¼Œå¦‚å­—ç¬¦ä¸²è¡¨ç¤ºæ¥å£|è‡ªå®šä¹‰ç±»å®ç°æ¥å£ä»¥èå…¥è¯­è¨€|â­â­|
|**è¿ç®—ç¬¦é‡è½½**|å®šä¹‰Â `__add__`Â ç­‰ä½¿è‡ªå®šä¹‰ç±»æ”¯æŒè¿ç®—ç¬¦|æ³¨æ„Â `__radd__`Â å¤„ç†å³æ“ä½œæ•°ï¼›è¿”å›Â `NotImplemented`Â è¡¨ç¤ºä¸æ”¯æŒ|â­â­â­|
|**ç±»å‹åˆ†æ´¾**|åœ¨æ–¹æ³•ä¸­ç”¨Â `isinstance`Â æ£€æŸ¥å‚æ•°ç±»å‹|å¤„ç†æ··åˆç±»å‹è¿ç®—|â­â­â­|
|**æ¯”ä¾‹ç±»å®ç°**|è‡ªåŠ¨çº¦åˆ†ã€åŠ æ³•ã€æ··åˆè¿ç®—ã€ç±»å‹è½¬æ¢|ç»¼åˆè¿ç”¨ç‰¹æ®Šæ–¹æ³•å’Œç±»å‹åˆ†æ´¾|â­â­â­â­|

---

## ä¹ã€è‡ªæµ‹é¢˜

### 1.Â `repr`Â ä¸Â `str`

```python

class Test:
    def __repr__(self):
        return 'repr'
    def __str__(self):
        return 'str'
t = Test()
print(t)
print(str(t))
print(repr(t))
```
è¾“å‡ºæ˜¯ä»€ä¹ˆï¼Ÿ


```text

str
str
repr
```
`print(t)`Â è°ƒç”¨Â `str(t)`ï¼Œå³Â `__str__`ï¼›`str(t)`Â æ˜¾å¼è°ƒç”¨Â `__str__`ï¼›`repr(t)`Â è°ƒç”¨Â `__repr__`ã€‚


### 2. f-string è½¬æ¢

```python

class Num:
    def __str__(self):
        return 'str'
    def __repr__(self):
        return 'repr'
n = Num()
print(f'{n}')
print(f'{n!r}')
```

```text

str
repr
```
é»˜è®¤ä½¿ç”¨Â `__str__`ï¼Œ`!r`Â å¼ºåˆ¶ä½¿ç”¨Â `__repr__`ã€‚

### 3. å¤šæ€å‡½æ•°

ä¸ºä»€ä¹ˆè¯´Â `repr`Â æ˜¯ä¸€ä¸ªå¤šæ€å‡½æ•°ï¼Ÿè¯·ç”¨ä»£ç ä¸¾ä¾‹è¯´æ˜ã€‚


`repr`Â å¯ä»¥æ¥å—ä»»ä½•å¯¹è±¡ï¼Œå¹¶è¿”å›å…¶å­—ç¬¦ä¸²è¡¨ç¤ºã€‚ä¾‹å¦‚Â `repr(123)`ã€`repr('abc')`ã€`repr([1,2])`ã€`repr(Fraction(1,2))`Â éƒ½èƒ½æ­£ç¡®å·¥ä½œï¼Œè¿™ä¾èµ–äºæ¯ä¸ªå¯¹è±¡è‡ªå·±çš„Â `__repr__`Â æ–¹æ³•ã€‚



### 4. åŠ æ³•é‡è½½

ä¸ºÂ `Ratio`Â ç±»å®ç°Â `__sub__`Â æ–¹æ³•ï¼ˆå‡æ³•ï¼‰ï¼Œå¹¶ç¡®ä¿å®ƒæ”¯æŒæ•´æ•°è¿ç®—ã€‚

```python

def __sub__(self, other):
    if isinstance(other, Ratio):
        n = self.numer * other.denom - self.denom * other.numer
        d = self.denom * other.denom
        return Ratio(n, d)
    elif isinstance(other, int):
        return Ratio(self.numer - self.denom * other, self.denom)
    else:
        return NotImplemented
def __rsub__(self, other):
    if isinstance(other, int):
        return Ratio(other * self.denom - self.numer, self.denom)
    return NotImplemented

```

### 5. æ€è€ƒé¢˜

ä¸ºä»€ä¹ˆ Python çš„Â `repr`Â å®ç°è¦å¿½ç•¥å®ä¾‹ä¸Šçš„Â `__repr__`Â å±æ€§ï¼Œè€Œå¼ºåˆ¶ä½¿ç”¨ç±»å±æ€§ï¼Ÿ


è¿™æ˜¯ä¸ºäº†é˜²æ­¢å®ä¾‹æ„å¤–åœ°ï¼ˆæˆ–æ¶æ„åœ°ï¼‰å°†Â `__repr__`Â è®¾ç½®ä¸ºéå‡½æ•°å¯¹è±¡ï¼ˆä¾‹å¦‚ä¸€ä¸ªæ•´æ•°ï¼‰ï¼Œå¯¼è‡´Â `repr`Â æ— æ³•æ­£å¸¸å·¥ä½œã€‚é€šè¿‡ç±»å±æ€§æŸ¥æ‰¾ï¼Œä¿è¯äº†Â `__repr__`Â å§‹ç»ˆæ˜¯æ–¹æ³•ï¼Œå¯ä»¥è¢«æ­£ç¡®è°ƒç”¨ã€‚


---

## åã€æ€»ç»“ä¸å±•æœ›

æœ¬èŠ‚è¯¾æˆ‘ä»¬æ·±å…¥æ¢è®¨äº†å¯¹è±¡çš„å­—ç¬¦ä¸²è¡¨ç¤ºæœºåˆ¶ï¼Œå­¦ä¹ äº†ï¼š

- `repr`Â å’ŒÂ `str`Â çš„åŒºåˆ«ä¸ç”¨é€”ã€‚
    
- f-string çš„ç®€æ´è¯­æ³•ä¸æ½œåœ¨å‰¯ä½œç”¨ã€‚
    
- å¤šæ€å‡½æ•°çš„åŸç†ä¸å®ç°ã€‚
    
- ç‰¹æ®Šæ–¹æ³•å¦‚ä½•èµ‹äºˆè‡ªå®šä¹‰ç±»ä¸°å¯Œçš„è¡Œä¸ºã€‚
    
- æ¥å£çš„æ¦‚å¿µå’Œè‡ªå®šä¹‰ç±»çš„æ¥å£å®ç°ã€‚
    
- é€šè¿‡Â `Ratio`Â ç±»å®Œæ•´æ¼”ç¤ºäº†è¿ç®—ç¬¦é‡è½½ã€ç±»å‹åˆ†æ´¾ã€ç±»å‹è½¬æ¢ç­‰é«˜çº§ç‰¹æ€§ã€‚
    

æŒæ¡è¿™äº›çŸ¥è¯†åï¼Œä½ å¯ä»¥è®©è‡ªå·±çš„ç±»åƒå†…ç½®ç±»å‹ä¸€æ ·è‡ªç„¶ã€å¼ºå¤§ã€‚åœ¨åç»­è¯¾ç¨‹ä¸­ï¼Œæˆ‘ä»¬å°†å­¦ä¹ æ›´å¤šé«˜çº§é¢å‘å¯¹è±¡ç‰¹æ€§ï¼Œå¦‚å…ƒç±»ã€æè¿°ç¬¦ç­‰ï¼Œç»§ç»­æ·±åŒ–å¯¹ Python å¯¹è±¡æ¨¡å‹çš„ç†è§£ã€‚