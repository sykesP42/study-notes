# 📘 Lecture 1：表达式与Python入门


---

## 一、什么是表达式？

### 🔹 表达式的定义

**表达式**（Expression）是**描述一个计算过程**的代码片段，它最终会**求值**（evaluate）为一个具体的**值**。

- 示例：`18 + 69` 是一个表达式，它描述了“将18和69相加”的过程，求值结果为 `87`。
    
- 数学中：`sin(π)`、`√9`、`7/3` 都是表达式。
    
- 编程中：`2 + 3`、`max(5, 8)`、`'Hello' + 'World'` 也都是表达式。
    

> ✅ 核心：表达式 **一定有返回值**。这是它和“语句”（statement）的最大区别（语句通常执行动作，不一定返回值，如赋值语句 `a = 3` 在Python中不返回值）。

### 🔹 数学表达式的多样性

数学中表达相同运算可以用完全不同的符号：

|运算|数学写法|例子|
|---|---|---|
|加法|中缀 `+`|`18 + 69`|
|除法|分数形式|623236​|
|平方根|根号 “√”|34931613493161​|
|正弦|函数名 `sin`|sin⁡πsinπ|

这种多样性对人类友好，但对计算机来说需要**统一的形式**，否则编译器/解释器需要为每一种符号单独编写解析规则。

### 🔹 统一表示法：函数调用形式

数学中其实存在一种**通用形式**：`f(x, y)` —— 函数名后跟括号，括号内是用逗号分隔的参数。

- 加法可以写为：`add(18, 69)`
    
- 除法：`div(6, 23)`
    
- 平方根：`sqrt(3493161)`
    
- 正弦：`sin(pi)`
    

**函数调用表达式** 将**运算符**（函数名）和**操作数**（参数）统一在一种语法结构中，去掉了特殊符号，使得表达式结构清晰、易于计算机解析。

> 💡 在Python中，我们可以通过导入 `operator` 模块来使用这种函数形式的运算。

---

## 二、Python 中的表达式

### 1. 交互式解释器（REPL）

Python 安装后会提供一个交互式环境（Read-Eval-Print Loop，读取-求值-打印循环）。  
在终端输入 `python` 即可进入，提示符为 `>>>`。

- 输入表达式 → 解释器 **读取** 并 **求值** → 立即 **打印** 结果 → 等待下一条输入。
    

#### 示例：

```python

>>> 2000 + 15
2015
>>> (5 + 3) * 2
16
>>> 2 ** 10
1024
>>> import math
>>> math.sqrt(9)
3.0
```
> ⚠️ 注意：直接输入数字 `42` 也是一个表达式，它求值结果为自身。

### 2. 基本算术运算

Python 支持以下算术运算符（按优先级从高到低排列）：

|运算符|含义|示例|结果|
|---|---|---|---|
|`**`|幂|`2 ** 3`|`8`|
|`+x, -x`|正负号|`-5`|`-5`|
|`*, /, //, %`|乘、除、整除、取余|`7 // 2`|`3`|
|`+, -`|加、减|`7 - 3`|`4`|

> 🔍 细节解释：
> 
> - `/` 总是返回浮点数，即使能整除：`4 / 2` → `2.0`
>     
> - `//` 是向下取整的整除：`-7 // 2` → `-4`（因为 `-3.5` 向下取整为 `-4`）
>     
> - `%` 是取余，满足 `a = (a // b) * b + (a % b)`
>     

#### 优先级示例

```python

>>> 2 + 3 * 4    # 乘法优先，相当于 2 + (3*4) = 14
14
>>> (2 + 3) * 4  # 括号改变优先级
20
>>> 2 ** 3 ** 2  # 幂运算是右结合，相当于 2 ** (3**2) = 2**9 = 512
512
```
### 3. 函数形式的运算

为了统一所有运算，Python 的 `operator` 模块提供了与运算符对应的函数：

- `add(a, b)` 对应 `a + b`
    
- `mul(a, b)` 对应 `a * b`
    
- `sub(a, b)` 对应 `a - b`
    
- `truediv(a, b)` 对应 `a / b`
    
- `pow(a, b)` 对应 `a ** b`
    

#### 使用方式：

```python

>>> from operator import add, mul, sub
>>> add(2, 3)
5
>>> mul(2, 3)
6
>>> sub(10, 4)
6
```
#### ✅ 函数形式的优势

1. **完全统一**：所有运算都遵循相同的 `函数(参数)` 语法，无需记忆运算符优先级。
    
2. **可作为参数传递**：函数本身可以当作值传递给其他函数（高阶函数的基础）。
    
3. **嵌套结构清晰**：复杂表达式通过嵌套函数调用，天然体现了计算顺序。
    

#### 示例：用函数形式表达 `(2+3)*4`

```python

>>> mul(add(2, 3), 4)
20
```
这里 `add(2, 3)` 先求值得 `5`，然后 `mul(5, 4)` 得 `20`，顺序一目了然。

### 4. 嵌套表达式与求值顺序（重点）

#### 例题：计算 `mul(add(2, mul(4, 6)), add(3, 5))`

**逐步分解**：

1. 最内层 `mul(4, 6)` → `24`
    
2. 左边 `add(2, 24)` → `26`
    
3. 右边 `add(3, 5)` → `8`
    
4. 最外层 `mul(26, 8)` → `208`
    

> 🔁 嵌套表达式的求值遵循 **递归规则**：先求值所有子表达式，再将函数应用于结果。

#### 为什么必须这样？

- 因为函数调用需要具体的参数值，而参数本身可能又是表达式，必须先算出参数的值。
    
- 这就决定了求值顺序是 **从内向外**、**从左到右**（操作数的求值顺序在Python中是从左到右，但函数调用本身不保证操作数求值顺序，这里先假设从左到右方便理解）。
    

#### 与中缀运算符对比

中缀写法：`(2 + 4*6) * (3 + 5)`

- 人需要知道优先级：乘法先于加法，括号最优先。
    
- 函数调用写法：`mul(add(2, mul(4,6)), add(3,5))`
    
- 优先级由嵌套结构直接体现，无需额外规则。
    

> ⭐ **课程主张**：推荐使用函数调用表达式，尤其在初学阶段，能帮你**显式地理解求值顺序**，避免优先级混淆。

---

## 三、调用表达式的构造与求值过程

### 1. 调用表达式的语法结构

一个调用表达式由三部分组成：

- **运算符子表达式**：括号前面的部分，通常是一个函数名。
    
- **括号**：必须成对出现，表示函数调用。
    
- **操作数子表达式**：括号内用逗号分隔的表达式，每个操作数本身也可以是任意表达式。
    

示例：`add(2, mul(3, 4))`

- 运算符：`add`
    
- 操作数1：`2`
    
- 操作数2：`mul(3, 4)`（又是一个调用表达式）
    

### 2. 求值过程的两个步骤

Python 解释器在求值一个调用表达式时，严格执行以下步骤：

1. **求值子表达式**
    
    - 先求值**运算符子表达式**，得到一个函数对象（例如 `add` 对应的函数）。
        
    - 然后从左到右求值**每个操作数子表达式**，得到一系列实参值。
        
2. **应用函数**
    
    - 将第1步得到的函数对象，作用于第1步得到的实参值，得到整个表达式的值。
        

> 💡 这个过程是 **递归** 的：如果某个操作数本身也是调用表达式，就重复上述两个步骤，直到所有子表达式都变成基本值（如数字）。

#### 示例：`mul(add(2, mul(4, 6)), add(3, 5))` 的详细求值过程

我们用缩进来表示递归层次：

```text

求值 mul(add(2, mul(4,6)), add(3,5))
├─ 求值运算符子表达式 mul → <built-in function mul>
├─ 求值第一个操作数 add(2, mul(4,6))
│  ├─ 求值运算符 add → <built-in function add>
│  ├─ 求值第一个操作数 2 → 2
│  ├─ 求值第二个操作数 mul(4,6)
│  │  ├─ 求值运算符 mul → <built-in function mul>
│  │  ├─ 求值第一个操作数 4 → 4
│  │  ├─ 求值第二个操作数 6 → 6
│  │  └─ 应用 mul(4,6) → 24
│  └─ 应用 add(2,24) → 26
├─ 求值第二个操作数 add(3,5)
│  ├─ 求值运算符 add → <built-in function add>
│  ├─ 求值第一个操作数 3 → 3
│  ├─ 求值第二个操作数 5 → 5
│  └─ 应用 add(3,5) → 8
└─ 应用 mul(26,8) → 208
```
**关键点**：

- 每个子表达式求值完成后，才会继续外层。
    
- 运算符和操作数本身也是表达式，但像数字这样的“原子表达式”求值结果就是它自己。
    
- 整个过程就是**反复应用同样的两步规则**，直到得到最终值。
    

---

## 四、表达式树 —— 可视化的求值顺序

### 1. 什么是表达式树？

表达式树（Expression Tree）是一种树形结构，用来表示表达式的计算层次：

- 每个**内部节点**代表一个函数调用（运算符）
    
- 每个**子节点**代表一个操作数（可以是原子值，也可以是子表达式树）
    
- 叶子节点是基本值（数字、变量等）
    

### 2. 绘制表达式树

对于表达式 `mul(add(2, mul(4,6)), add(3,5))`，其树形结构如下：

```text

        mul
       /   \
     add    add
    /  \   /   \
   2   mul 3    5
       / \
      4   6
```
- 树根是 `mul`，表示最终乘法。
    
- 左子树是 `add(2, mul(4,6))`，右子树是 `add(3,5)`。
    
- 左子树的右子节点又是一个子树 `mul(4,6)`。
    

### 3. 如何通过表达式树理解求值顺序？

计算机在求值表达式树时，采用 **后序遍历**（post-order traversal）：

1. 先递归求值左子树
    
2. 再递归求值右子树
    
3. 最后将左右子树的值作为参数调用根节点的函数
    

这正是我们在上一节中看到的 **从内向外、从左到右** 的顺序。

#### 结合树形图一步步看：

- 第一步：计算最深的 `mul(4,6)` → 24
    
- 第二步：计算左子树的 `add(2,24)` → 26
    
- 第三步：计算右子树的 `add(3,5)` → 8
    
- 第四步：计算根 `mul(26,8)` → 208
    

> 💡 表达式树清晰地展示了**子表达式之间的依赖关系**：只有当一个节点的所有子节点都求值完毕，该节点才能求值。

### 4. 为什么需要理解表达式树？

- 帮助理解编程语言中表达式的**求值顺序**和**作用域**。
    
- 为后续学习**抽象语法树**（AST）、编译器原理打下基础。
    
- 在调试复杂表达式时，可以在脑中构建树，找出求值错误点。
    

---

## 五、常见错误与注意事项（初学者必看）

### ❌ 错误1：忘记导入函数

```python

>>> add(2, 3)
Traceback (most recent call last):
  File "<stdin>", line 1, in <module>
NameError: name 'add' is not defined
```
**解决**：先执行 `from operator import add`。

### ❌ 错误2：括号不匹配


```python

>>> mul(add(2, 3, 4)   # 少了一个右括号
  File "<stdin>", line 1
    mul(add(2, 3, 4)
         ^
SyntaxError: unexpected EOF while parsing
```
**解决**：确保括号成对出现，可以使用代码编辑器的高亮功能。

### ❌ 错误3：混淆中缀与函数调用的优先级

```python

>>> add(2, 3) * 4   # 这是合法的，先调用add再乘4
20
>>> add(2, 3 * 4)   # 这是不同的：先乘3*4再调用add
14
```
**注意**：在同一个表达式中混用两种风格时，要清楚**函数调用优先级高于所有运算符**？实际上，Python中函数调用的优先级非常高（仅次于幂运算），但为了避免混淆，建议要么全用函数调用，要么全用中缀，不要混用复杂结构。

### ❌ 错误4：操作数个数不匹配

```python

>>> add(2)          # add需要两个参数
Traceback (most recent call last):
  File "<stdin>", line 1, in <module>
TypeError: add expected 2 arguments, got 1
```
**解决**：检查函数需要的参数个数。

---

## 六、自测题 —— 检验理解程度

### 1. 基础题

将以下中缀表达式改写为函数调用形式（使用 `add`、`mul`、`sub` 等）：  
a) `3 + 5 * 2`  
b) `(10 - 4) / 3`  
c) `2 ** 3 + 1`

<details> <summary>参考答案</summary>

a) `add(3, mul(5, 2))`  
b) `truediv(sub(10, 4), 3)` （需要导入 `truediv`）  
c) `add(pow(2, 3), 1)` （需要导入 `pow`）

</details>

### 2. 表达式求值

手动计算以下表达式的值，并写出求值步骤：

```text

mul(add(5, sub(8, 3)), add(2, 2))
```

1. 最内层 `sub(8, 3)` → 5
    
2. 左边 `add(5, 5)` → 10
    
3. 右边 `add(2, 2)` → 4
    
4. 最终 `mul(10, 4)` → 40
    



### 3. 画表达式树

画出表达式 `add(mul(2, 3), mul(4, add(5, 1)))` 的树形图。


```text

        add
       /   \
     mul    mul
    /  \   /   \
   2    3 4    add
              /   \
             5     1
```

### 4. 思考题

为什么编程语言需要明确定义的求值顺序？如果操作数的求值顺序不确定会有什么问题？

<details> <summary>提示</summary>

如果操作数求值顺序不确定，那么当操作数包含带有副作用的表达式（如修改变量）时，程序结果将不可预测。Python 保证从左到右求值操作数，避免了歧义。

</details>

---

## 七、知识点总览表（含扩展说明）

|知识点|核心内容|详细说明 / 示例|常见错误 / 易混淆点|难度|
|---|---|---|---|---|
|**表达式定义**|描述计算并求值|`3+5` 求值得 `8`；`'a'+'b'` 求值得 `'ab'`|表达式 vs 语句（如 `x=3` 是语句）|⭐⭐|
|**函数调用表示法**|统一所有运算|`add(2,3)` 代替 `2+3`|忘记导入函数；函数名拼写错误|⭐⭐⭐|
|**解释器交互**|`>>>` 输入即求值|`>>> max(3,5)` → `5`|多行输入需缩进（如定义函数）|⭐⭐|
|**嵌套表达式优先级**|括号决定计算顺序|`mul(add(2,3),4)` 先加后乘|中缀优先级混淆：`2+3*4` 是 `14` 不是 `20`|⭐⭐⭐|
|**表达式树与求值顺序**|树形表示依赖关系|后序遍历：先子节点后父节点|必须从最内层开始计算|⭐⭐⭐|
|**运算符与函数等价性**|`+` ↔ `add`, `*` ↔ `mul`|两者计算结果相同，但函数形式更统一|中缀运算符优先级隐式存在|⭐⭐|
|**求值规则**|先求值子表达式，再应用函数|递归规则适用于嵌套|错误假设运算顺序（如从左到右不考虑优先级）|⭐⭐⭐|

---

## 八、延伸思考：为什么从表达式开始学编程？

表达式是编程语言中最基本的**计算单元**。掌握表达式的构造与求值，等于掌握了程序的“呼吸”：

- 变量赋值、条件判断、循环控制等最终都依赖于表达式。
    
- 函数调用本身就是表达式的一种。
    
- 理解表达式树，就能理解程序是如何被计算机一步步执行的。
    

在后续课程中，我们将学习如何定义自己的函数，如何组合表达式形成更复杂的程序，而所有的基础都在于对表达式深刻的理解。